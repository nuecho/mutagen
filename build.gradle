plugins {
  id 'com.diffplug.gradle.spotless' version '3.8.0'
  id 'org.jetbrains.kotlin.jvm' version '1.2.21'
  id 'com.github.johnrengelman.shadow' version '2.0.2'
}

repositories {
  mavenCentral()
  maven { url 'http://knox.s.nuecho.com/artifactory/repo' }
}

apply plugin: 'jacoco'
apply plugin: 'com.diffplug.gradle.spotless'

// Workaround for https://github.com/johnrengelman/shadow/issues/336
// It allows the mainClassName property to be properly set.
apply plugin: 'application'

description = 'Nu Echo\'s Genesys Command Line Interface'
group = 'com.nuecho'
version = "${version}"
mainClassName = 'com.nuecho.genesys.cli.GenesysCli'

sourceCompatibility = '1.8'
targetCompatibility = '1.8'

test {
  testLogging {
    exceptionFormat = 'full'
  }
}

jacocoTestReport {
  reports {
    html.enabled true
  }
}

spotless {
  kotlin {
    ktlint('0.15.0')
  }
}

shadowJar {
  baseName = 'gen'
  classifier = null
  version = version
}

dependencies {
  compile 'org.jetbrains.kotlin:kotlin-stdlib-jdk8:1.2.+'
  compile 'org.jetbrains.kotlin:kotlin-reflect:1.2.+'

  compile 'com.fasterxml.jackson.module:jackson-module-kotlin:2.9.+'
  compile 'com.fasterxml.jackson.dataformat:jackson-dataformat-yaml:2.9.+'

  compile 'com.googlecode.java-diff-utils:diffutils:1.2.+'
  compile 'com.typesafe:config:1.3.+'
  compile 'info.picocli:picocli:2.2.+'

  compile 'com.genesyslab.platform:comappblock:+'
  compile 'com.genesyslab.platform:commons:+'
  compile 'com.genesyslab.platform:configurationprotocol:+'

  testCompile 'io.kotlintest:kotlintest:2.0.+'
}

runShadow {
  // Allow passing arguments using gradlew runShadow
  // gradlew runShadow -Dexec.args="..."
  args System.getProperty("exec.args", "").split()
}